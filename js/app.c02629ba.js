(function(e){function t(t){for(var n,o,l=t[0],s=t[1],d=t[2],u=0,m=[];u<l.length;u++)o=l[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);c&&c(t);while(m.length)m.shift()();return i.push.apply(i,d||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,l=1;l<r.length;l++){var s=r[l];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={app:0},i=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/navigation-proto/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var c=s;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},1336:function(e){e.exports=JSON.parse('{"layers":[{"type":"wms","url":"https://geo.weather.gc.ca/geomet?lang=fr&service=WMS&version=1.3.0&request=GetCapabilities&layer=RADAR_1KM_RSNO","title":{"en":"LayerEN","fr":"Précipitation radar"},"visibleLayer":true,"infoLegende":["Légende","<img src=\\"https://geo.weather.gc.ca/geomet?lang=fr&version=1.3.0&service=WMS&request=GetLegendGraphic&sld_version=1.1.0&layer=RADAR_1KM_RRAI&format=image/png&STYLE=RADARURPPRECIPR14-LINEAR\\">"],"groupeParent":"Radar","name":"layerPrecipitation"},{"type":"wms","url":"https://geo.weather.gc.ca/geomet?lang=fr&service=WMS&version=1.3.0&request=GetCapabilities&layer=RADAR_COVERAGE_RRAI.INV","title":{"en":"LayerEN","fr":"Couverture Radar"},"visibleLayer":false,"groupeParent":"Radar","name":"layerCoveragePrecipitation"},{"type":"wfs","url":"https://geoserver.preprod.ogsl.ca/geoserver/ogc/features/","collectionId":"robitaillej:test_create_shp","title":{"en":"LayerEN","fr":"regions"},"visibleLayer":true,"name":"layer_regions","renderer":{"type":"simple","symbol":{"type":"simple-fill"}}}],"groupes":[{"title":{"en":"GroupEn","fr":"Radar"}}]}')},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("web-map",{attrs:{id:"viewDiv"}}),r("div",{attrs:{id:"layerlist"}}),e._m(0)],1)},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"panel"}},[r("div",{attrs:{id:"region"}},[e._v("Prévisions météo maritime - veuillez cliquer sur une région")]),r("div",{attrs:{id:"emis"}}),r("table",{attrs:{id:"headerVent"}}),r("div",{attrs:{id:"vent"}}),r("table",{attrs:{id:"headerVagues"}}),r("div",{attrs:{id:"vagues"}}),r("table",{attrs:{id:"headerConditions"}}),r("div",{attrs:{id:"conditions"}}),r("table",{attrs:{id:"longTerme"}}),r("div",{attrs:{id:"emisExtent"}})])}],o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div")},l=[],s=(r("7db0"),r("b0c0"),r("3835")),d=r("afaa");function c(e){var t;t="test_create_shp.1"===e?"m0000198_f":"m0000199_f";var r=new XMLHttpRequest;r.open("GET","https://cors-anywhere.herokuapp.com/https://dd.meteo.gc.ca/marine_weather/xml/st_lawrence/"+t+".xml",!0),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=r.responseText;console.log(e);var t=new DOMParser,n=t.parseFromString(e,"text/xml");console.log(n);var a=document.getElementById("buttonWarning");a&&a.remove();var i=document.getElementById("textWarning");if(i&&i.remove(),document.getElementById("region").innerHTML=n.getElementsByTagName("area")[0].innerHTML,0!==n.getElementsByTagName("warnings").length&&null===n.getElementsByTagName("warnings")[0].innerHTML){console.log(n.getElementsByTagName("warnings")[0].innerHTML);var o=n.getElementsByTagName("warnings")[0];if("EN VIGUEUR"===o.getElementsByTagName("event")[0].getAttribute("status")){var l=document.createElement("div");l.setAttribute("id","textWarning"),l.innerHTML=o.getElementsByTagName("event")[0].getAttribute("name")+" en vigueur pour cette région. Pour plus de détails, veuillez consulter <a href=https://meteo.gc.ca/marine/region_f.html?mapID=12 target='_blank'>météo maritime Canada</a>.",l.style.display="none";var s=document.getElementById("headerVent");s.insertAdjacentElement("beforebegin",l);var d=document.createElement("BUTTON");d.innerHTML="Avertissement",d.setAttribute("id","buttonWarning"),d.onclick=function(){var e=document.getElementById("textWarning");"none"===e.style.display?e.style.display="block":e.style.display="none"},l.insertAdjacentElement("beforebegin",d)}}var c=n.getElementsByTagName("regularForecast")[0];if(c){document.getElementById("emis").innerHTML="Prévisions émises le "+c.getElementsByTagName("textSummary")[1].innerHTML;var u=c.getElementsByTagName("wind")[0],m=c.getElementsByTagName("periodOfCoverage")[0];u&&(document.getElementById("headerVent").innerHTML="<tr><td id=header>Vent</td><td id=periode>pour "+m.innerHTML+"</td></tr>",document.getElementById("vent").innerHTML=u.innerHTML);var p=c.getElementsByTagName("weatherVisibility")[0];p&&(document.getElementById("headerConditions").innerHTML="<tr><td id=header>Conditions et visibilité</td><td id=periode>pour "+m.innerHTML+"</td></tr>",document.getElementById("conditions").innerHTML=p.innerHTML)}var g=n.getElementsByTagName("waveForecast")[0];if(g){var y=g.getElementsByTagName("weatherCondition")[0],f=y.getElementsByTagName("textSummary")[0],v=c.getElementsByTagName("periodOfCoverage")[0];f&&(document.getElementById("headerVagues").innerHTML="<tr><td id=header>Vagues</td><td id=periode>pour "+v.innerHTML+"</td></tr>",document.getElementById("vagues").innerHTML=f.innerHTML)}document.getElementById("longTerme").innerHTML="<tr><th colspan='2'>Prévisions long terme</th></tr>";var h=n.getElementsByTagName("extendedForecast")[0];if(h)for(var b=h.getElementsByTagName("weatherCondition")[0],T=b.getElementsByTagName("forecastPeriod"),w=0;w<T.length;w++)document.getElementById("longTerme").insertAdjacentHTML("beforeend","<tr><td>"+T[w].getAttribute("name")+"</td><td>"+T[w].innerHTML+"</td></tr>");else document.getElementById("longTerme").insertAdjacentHTML("beforeend","<tr><td>Prévisions long terme non disponibles pour le moment</td></tr>");document.getElementById("emisExtent").innerHTML="Prévisions long terme émises le "+h.getElementsByTagName("textSummary")[1].innerHTML}},r.send(null)}var u=c,m=(r("d81d"),r("5698"));function p(e,t,r){for(var n=m["m"]("%Y-%m-%dT%H:%M:00Z"),a=0;a<e.length;a++)e[a].date=n(e[a].eventDate);console.log("data",e);var i=m["g"](e,(function(e){return e.value})),o=m["f"](e,(function(e){return e.value})),l=400,s=300,d={top:20,bottom:70,left:30,right:20},c=m["k"](t).append("svg").attr("height",s).attr("width",l),u=m["j"]().domain(m["d"](e,(function(e){return e.date}))).range([d.left,l-d.right]),p=m["i"]().domain(m["d"](e,(function(e){return e.value}))).range([s-d.bottom,d.top]);c.append("g");var g=m["e"]().x((function(e){return u(e.date)})).y((function(e){return p(e.value)}));c.append("path").data([e]).attr("class","line").attr("d",g).style("stroke-width",2).style("stroke","blue").style("fill","none");var y=n(r);console.log(y);var f=[{date:y,yvalue:i},{date:y,yvalue:o}],v=m["e"]().x((function(e){return u(e.date)})).y((function(e){return p(e.yvalue)}));console.log(f),c.append("path").data([f]).attr("class","line").attr("d",v).style("stroke-width",2).style("stroke","red").style("fill","none");var h=s-d.bottom,b=m["l"]("%d/%m %H:%M");c.append("g").attr("class","axis").attr("transform","translate(0,"+h+")").call(m["a"](u).ticks(10).tickFormat(b)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)").style("font-size",10),c.append("g").attr("class","y axis").attr("transform","translate("+d.left+",0)").call(m["b"](p).ticks(6));var T=c.append("g").append("circle").style("fill","none").attr("stroke","black").attr("r",8.5).style("opacity",0),w=c.append("g").append("text").style("opacity",0).attr("text-anchor","left").attr("alignment-baseline","middle");function E(){T.style("opacity",1),w.style("opacity",1)}c.append("rect").style("fill","none").style("pointer-events","all").attr("width",l).attr("height",s).on("mouseover",E).on("mousemove",N).on("mouseout",B);var L,M=e.map((function(e){return e.date}));function N(){var t=u.invert(m["h"](event)[0]),r=m["c"](M,t);L=e[r],console.log(L),T.attr("cx",u(L.date)).attr("cy",p(L.value)),w.html(L.value).attr("x",u(L.date)+15).attr("y",p(L.value)).style("stroke","black")}function B(){T.style("opacity",0),w.style("opacity",0)}console.log(M)}var g=p,y=r("1336"),f=(r("4d90"),r("1157")),v=r.n(f),h=v.a;function b(){var e;return h.ajax({url:"https://api.iwls.azure.cloud.dfo-mpo.gc.ca/api/v1/stations",type:"GET",async:!1,contentType:"application/json; charset=utf-8",success:function(t){e=t}}),e}function T(e){var t,r,n=new Date,a=String(n.getUTCFullYear()),i=String(n.getUTCMonth()+1).padStart(2,"0"),o=String(n.getUTCDate()).padStart(2,"0"),l=String(n.getUTCDate()+1).padStart(2,"0"),s=String(n.getUTCHours()).padStart(2,"0"),d=String(n.getUTCHours()-1).padStart(2,"0"),c=String(n.getUTCMinutes()).padStart(2,"0"),u=a+"-"+i+"-"+o+"T"+d+":"+c+":00Z",m=a+"-"+i+"-"+o+"T"+s+":"+c+":00Z",p=a+"-"+i+"-"+o+"T"+s+":"+c+":00Z",g=a+"-"+i+"-"+l+"T"+s+":"+c+":00Z";"wlo"===e.color&&(h.ajax({url:"https://api.iwls.azure.cloud.dfo-mpo.gc.ca/api/v1/stations/"+e.id+"/data?time-series-code=wlo&from="+u+"&to="+p,type:"GET",async:!1,contentType:"application/json; charset=utf-8",success:function(e){t=e}}),e.lastDate=t[t.length-1]["eventDate"],e.lastWlo=t[t.length-1]["value"]);h.ajax({url:"https://api.iwls.azure.cloud.dfo-mpo.gc.ca/api/v1/stations/"+e.id+"/data?time-series-code=wlp&from="+u+"&to="+g,type:"GET",async:!1,contentType:"application/json; charset=utf-8",success:function(e){r=e}}),e.lastDateWlp=r[r.length-1]["eventDate"],e.lastWlp=r[r.length-1]["value"],e.predictions=r,e.timeNow=m,console.log("predictions",e.timeNow)}window.$=h;var w={name:"web-map",mounted:function(){var e=this;Object(d["loadModules"])(["esri/Map","esri/views/MapView","esri/layers/OGCFeatureLayer","esri/Graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/popup/content/CustomContent","esri/layers/WMSLayer","esri/widgets/LayerList","esri/layers/GroupLayer","esri/core/watchUtils"],{css:!0}).then((function(t){var r=Object(s["a"])(t,11),n=r[0],a=r[1],i=r[2],o=r[3],l=r[4],d=r[5],c=r[6],m=r[7],p=r[8],f=r[9],v=r[10],h=new n({basemap:"topo-vector"});e.view=new a({container:e.$el,map:h,center:[-68.805,47.027],zoom:7});var w=b(),E=L(y.groupes);function L(e){for(var t=[],r=0;r<e.length;r++){var n=new f({title:e[r].title.fr,layers:[],visible:!1});t.push(n),h.add(n)}return t}for(var M=0;M<y.layers.length;M++)if("wfs"===y.layers[M].type){var N=new i({url:y.layers[M].url,collectionId:y.layers[M].collectionId,popupEnabled:!0,name:y.layers[M].name,visible:!0,title:y.layers[M].title.fr,listMode:"hide",renderer:y.layers[M].renderer});h.add(N)}for(var B=function(e){v.watch(E[e],"visible",(function(t){if(t)for(var r=function(t){"wms"===y.layers[t].type&&y.layers[t].groupeParent===E[e].title&&(a=h.allLayers.find((function(e){return e.name===y.layers[t].name})),void 0===a&&(console.log("wms visible",y.layers[t].visibleLayer),i=new m({url:y.layers[t].url,title:y.layers[t].title.fr,name:y.layers[t].name,listMode:"hide-children",visible:y.layers[t].visibleLayer,infoLegende:y.layers[t].infoLegende}),E[e].add(i)))},n=0;n<y.layers.length;n++){var a,i;r(n)}}))},S=0;S<E.length;S++)B(S);var x,H=e.view;function I(e){var t=h.allLayers.find((function(e){return"stationsLayerTrue"===e.name}));if(!e.results[0].graphic.geometry)return t=h.allLayers.find((function(e){return"stationsLayerTrue"===e.name})),t&&h.remove(t),null;if("polygon"===e.results[0].graphic.geometry.type){var r=e.results[0].graphic.geometry;return console.log(r),t&&h.remove(t),H.goTo(e.results[0].graphic.geometry),console.log("attributes",e.results[0].graphic.attributes.OBJECTID),u(e.results[0].graphic.attributes.OBJECTID),r}var n=e.results[0].graphic.attributes;T(n)}function _(e){if(e){var t=new l({visible:!0,title:"Stations",name:"stationsLayerTrue",infoLegendeTitre:"Légende"});h.add(t);for(var r=0;r<w.length;r++){var n=new d({longitude:w[r]["longitude"],latitude:w[r]["latitude"],spatialReference:{wkid:3857}}),a=e.contains(n);if(a){for(var i=null,s=0;s<w[r]["timeSeries"].length;s++)"wlo"===w[r]["timeSeries"][s]["code"]&&(i="wlo");x=new o("wlo"===i?{geometry:n,symbol:{type:"simple-marker",color:"#d7191c"},popupTemplate:P,attributes:{id:w[r]["id"],officialName:w[r]["officialName"],timeSeries:w[r]["timeSeries"],color:i,lastDate:[],lastWlo:[],lastDateWlp:[],lastWlp:[],predictions:{},timeNow:[]}}:{geometry:n,symbol:{type:"simple-marker",color:"#1a9641"},popupTemplate:j,attributes:{id:w[r]["id"],officialName:w[r]["officialName"],timeSeries:w[r]["timeSeries"],color:i,lastDateWlp:[],lastWlp:[],predictions:{},timeNow:[]}}),t.add(x)}}}console.log("layer",t)}H.on("click",(function(e){H.hitTest(e).then(I).then(_)}));var C=new c({outFields:["*"],creator:function(e){var t=document.createElement("div"),r=e.graphic.attributes.predictions;t.innerHTML="Prédictions <br>";var n=r;return g(n,t,e.graphic.attributes.timeNow),t}}),P={title:"{officialName}",content:[{type:"fields",fieldInfos:[{fieldName:"lastDate",label:"Dernière date d'observation",format:{places:0,digitSeparator:!0}},{fieldName:"lastWlo",label:"Valeur"}]},C]},j={title:"{officialName}",content:[{type:"fields",fieldInfos:[{fieldName:"lastDateWlp",label:"Dernier moment de prédiction",format:{places:0,digitSeparator:!0}}]},C]},D=new p({view:e.view,container:document.createElement("div"),listItemCreatedFunction:function(e){var t=e.item;"infoLegende"in t.layer&&(t.panel={content:t.layer.infoLegende,open:!0})}});D.container.style="height: 100%";var O=document.getElementById("layerlist");O.appendChild(D.container)}))},beforeDestroy:function(){this.view&&this.view.destroy()}},E=w,L=r("2877"),M=Object(L["a"])(E,o,l,!1,null,null,null),N=M.exports,B={name:"App",components:{WebMap:N}},S=B,x=(r("5c0b"),Object(L["a"])(S,a,i,!1,null,null,null)),H=x.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(H)}}).$mount("#app")},"5c0b":function(e,t,r){"use strict";r("9c0c")},"9c0c":function(e,t,r){}});
//# sourceMappingURL=app.c02629ba.js.map